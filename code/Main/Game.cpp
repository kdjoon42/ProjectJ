////////////////////////////////////////////////////////////////////////////
//
//  Copyright (C) Justin 2010-.
// -------------------------------------------------------------------------
//  File name: Game.cpp
//  Created:   06-08-2010 by Dongjoon Kim
//
//////////////////////////////////////////////////////////////////////////// 

#include <Windows.h>
#include <boost/scoped_ptr.hpp>


#include <Main/Game.h>
#include <Main/IEngine.h>

namespace Main{

		//-----------------------------------------------------------------------------
		//!
		class Game : public IGame
		{
		public:
				//-----------------------------------------------------------------------------
				//!
				Game();

				//-----------------------------------------------------------------------------
				//!
				~Game();

				//-----------------------------------------------------------------------------
				//!
				bool Initialize(const GameConfig& config);

				//-----------------------------------------------------------------------------
				//!
				void Shutdown();

				//-----------------------------------------------------------------------------
				//!
				bool Update();

				//-----------------------------------------------------------------------------
				//!
				void Quit() { m_bQuit = true; }

		protected:
				bool m_bQuit;

				boost::scoped_ptr<IEngine> m_pEngine;
		};

		//////////////////////////////////////////////////////////////////////////
		//

		//-----------------------------------------------------------------------------
		boost::scoped_ptr<IGame> IGame::m_pInstance;

		//-----------------------------------------------------------------------------
		IGame& IGame::Instance()
		{
				if(!m_pInstance)
				{
						m_pInstance.reset(new Game());
				}

				return *m_pInstance;
		}

		//-----------------------------------------------------------------------------
		Game::Game()
				:m_bQuit(true)
		{

		}

		//-----------------------------------------------------------------------------
		Game::~Game()
		{

		}


		//-----------------------------------------------------------------------------
		bool Game::Initialize(const GameConfig& config)
		{
				m_pEngine.reset(IEngine::Create(config));

				m_bQuit = false;

				return true;
		}

		//-----------------------------------------------------------------------------
		void Game::Shutdown()
		{
				m_pInstance.reset();
		}

		//-----------------------------------------------------------------------------
		bool Game::Update()
		{
				if(!m_pEngine->Update())
						m_bQuit = true;

				return m_bQuit ? false : true;
		}

}//Main